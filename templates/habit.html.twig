{% extends 'base.html.twig' %}
{% set days_in_month = date('now')|date_modify('last day of this month')|date('d') %}
{% set dayName = 1 %}
{% set yearNow = "now"|date("Y") %}
{% set monthNow = "now"|date("m")  %}
{% set dayNow = "now"|date("d") %}
{% set dayOfMonth = 31 %}
{% set d = days|length %}

{% if monthNow == 4 or  monthNow == 6 or  monthNow == 11 or  monthNow == 9   %}
    {% set dayOfMonth = 30 %}
{% elseif monthNow == 2 %}
    {% if yearNow is divisible by(4) %}
        {% set dayOfMonth = 29 %}
    {% else %}
        {% set dayOfMonth = 28 %}
    {% endif %}
{% endif %}

{% block bodyExtraClasses %} habit-index {% endblock %}

{% block pageContent %}
    <div class="row">
        <div class="col container-fluid">
            <div class="row card">
                <div class="col card-body d-flex flex-column justify-content-center align-items-center">
                    <div class="row">
                        <h1> < {{ "now"|date("Y.m.") }} > </h1>
                    </div>
                    <div class="row">
                        <h2>{{ "now"|date('l') }} </h2>
                    </div>
                    <div class="d-flex pt-3">
                        <button type="button" class="btn red ms-2 me-2"><a
                                    href="{{ path('newHabit') }}">New
                                habit</a></button>
                    </div>
                </div>
            </div>
            <div class="card row">
                <div class="  card-body">
                    <h3>Habits</h3>
                    <table class="table table-borderless mt-5 mb-5">
                        <thead>
                            <tr>
                                <th>#</th>
{#                                todo: for day in 1..dayNumberOfMonth#}
                                {% for day in 1..dayOfMonth %}
                                    <td><a href={{ path('newCompletedHabits', {year: yearNow, month: monthNow, day:day})}}>{{ day }}</a></td>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                        {% for habit in habits %}
                            <tr>
                                <th >{{ habit.name }}</th>
                                {% for day in 1..dayOfMonth %}
                                    {% set completionStatus = false %}
                                    {%  if days is not empty %}
                                        {% for i in 0..d-1 %}
                                            {% if day == days[i] and names[i] == habit.name %}
                                                {% set completionStatus = true %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    {% if completionStatus %}
                                        {% if day >0 and day < 5 %}
                                            <td class="completed-red "></td>
                                        {% elseif day >= 5 and day < 9  %}
                                            <td class="completed-orange "></td>
                                        {% elseif day >= 9 and day < 13  %}
                                            <td class="completed-yellow "></td>
                                        {% elseif day >= 13 and day < 17  %}
                                            <td class="completed-green "></td>
                                        {% elseif day >= 17 and day < 21  %}
                                            <td class="completed-light-blue "></td>
                                        {% elseif day >= 21 and day < 24  %}
                                            <td class="completed-dark-blue "></td>
                                        {% elseif day >= 24 and day < 28  %}
                                            <td class="completed-purple "></td>
                                        {% elseif day >= 28 and day < 31  %}
                                            <td class="completed-pink "></td>
                                        {% endif %}
                                    {% else %}
                                        <td class=" habit">  </td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
{% endblock %}